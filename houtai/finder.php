<?php
//Copyright (c) 2016 iFeiwu.com
 class Finder extends Ifeiwu { private $root = "\x64\x61\x74\141\x2f\x66\x69\156\x64\145\x72\57"; function __construct() { goto Dh8b8; Dh8b8: if ($this->table) { goto Y7FYH; } goto orBMz; Qf792: Y7FYH: goto A6j7O; orBMz: $this->table = "\146\x69\x6e\x64\145\x72"; goto Qf792; A6j7O: parent::__construct(); goto Kebnw; Kebnw: } protected function postAll($pid, $request_data) { goto M1PQ2; GiIPQ: if (!$pid) { goto Aczm1; } goto uvl_s; k14TP: $paths = array(); goto GiIPQ; wY4VW: Aczm1: goto hpezU; M1PQ2: $files = $this->db->select($this->table)->where($request_data["\x77\150\145\162\145"])->order($request_data["\157\x72\x64\145\x72"])->all(); goto k14TP; vD3H3: $level = array_filter(explode("\54", $level)); goto dZNCx; uvl_s: $level = $this->db->select($this->table, "\154\x65\x76\x65\x6c")->where(array("\151\x64", "\x3d", $pid))->get(0); goto vD3H3; hpezU: return array("\146\151\x6c\x65\x73" => $files, "\x70\x61\x74\150\x73" => $paths); goto CR1cf; dZNCx: $paths = $this->db->select($this->table, array("\x69\x64", "\x6e\141\155\145"))->where(array("\x69\x64", "\111\x4e", $level), "\x41\116\104", array("\164\x79\160\x65", "\x3d", "\146\157\154\x64\145\162"))->all(); goto wY4VW; CR1cf: } protected function postAdd($request_data) { goto pUmfw; zbxBq: $this->db->rollBack(); goto WZgsj; hPA_3: $filename = $this->_UTF82GBK("\56\56\x2f" . $path . $name); goto vz8SQ; TbKxF: $this->db->rollBack(); goto KRHA2; j8jUq: return $this->success(); goto p00IJ; xRn33: $data["\143\x74\151\x6d\x65"] = time(); goto CfRfT; SvqxI: $level = $this->_getLevel($id); goto s4t8N; BUY1N: $type = mime_content_type("\56\x2e\57" . $path . $name); goto w1Ika; CfRfT: $data["\145\170\x74"] = end(explode("\56", $name)); goto W6CgW; WkA1R: return $this->error("\345\x88\x9b\xe5\xbb\272\xe6\x96\207\344\273\266\xe5\xa4\xb9\xe5\244\261\xe8\264\245\357\xbc\201"); goto eHcBq; KRHA2: return $this->error("\344\xb8\x8a\xe4\xbc\240\xe6\x96\x87\344\xbb\266\x20" . $name . "\x20\345\xa4\xb1\xe8\xb4\xa5\357\xbc\x81"); goto pwJf_; w1Ika: $foid = $request_data["\x66\157\x69\144"]; goto XXOZn; NRbPt: RM_me: goto hPA_3; p00IJ: D41ag: goto TbKxF; WZgsj: return $this->error("\344\270\212\344\xbc\xa0\346\226\x87\344\xbb\xb6\40" . $name . "\x20\xe5\244\261\xe8\264\xa5\357\274\201"); goto J2Lke; SEADh: $name = $request_data["\156\x61\x6d\x65"]; goto BUY1N; R6Tgg: if (mkdir($this->_UTF82GBK("\x2e\x2e\x2f" . $path), 511, true)) { goto xIlf9; } goto WkA1R; s4t8N: if (!$this->db->update($this->table, array("\154\x65\166\x65\x6c" => $level), array("\151\144", "\75", $id))->is()) { goto D41ag; } goto T6WCe; T6WCe: $this->db->commit(); goto j8jUq; gMfg6: $data["\x73\151\172\145"] = $request_data["\163\151\x7a\145"]; goto xRn33; ZJlHg: yXBu7: goto k1Kdc; W6CgW: $this->db->beginTransaction(); goto HbA8L; yfrNI: $imagesize = getimagesize($filename); goto BgEpD; B09sX: $data["\156\x61\x6d\145"] = $name; goto HcXcL; vz8SQ: if (!(stripos($type, "\151\155\141\147\x65") !== false && is_file($filename))) { goto yXBu7; } goto yfrNI; J2Lke: urpl2: goto SvqxI; XXOZn: if (is_dir($this->_UTF82GBK("\x2e\56\57" . $path))) { goto RM_me; } goto R6Tgg; eHcBq: xIlf9: goto NRbPt; pD6ee: $data["\150\x65\x69\x67\x68\164"] = $imagesize[1]; goto ZJlHg; HcXcL: $data["\164\x79\x70\145"] = $type; goto WSiJ9; pUmfw: $path = $request_data["\x70\141\164\150"]; goto SEADh; WSiJ9: $data["\x70\x69\144"] = $foid ? $foid : 0; goto gMfg6; b59SW: unlink($filename); goto zbxBq; HbA8L: if ($id = $this->db->insert($this->table, $data)->id()) { goto urpl2; } goto b59SW; k1Kdc: $data["\x70\141\164\x68"] = $path; goto B09sX; BgEpD: $data["\x77\x69\144\164\x68"] = $imagesize[0]; goto pD6ee; pwJf_: } protected function postMkdir($request_data) { goto Ko_fo; QpTLU: $this->db->rollBack(); goto HyA3Q; K7Q7q: UEJyh: goto EBbXJ; atNZR: rmdir($dirname); goto QpTLU; ST25i: return $this->success(); goto ZZBpw; sYZfr: bBKJU: goto DlaDw; kM9zF: $data["\163\x6f\162\164\x62\x79"] = 1; goto f4cYY; qaN3G: $data["\x63\164\x69\155\145"] = time(); goto TyDXM; z0SSi: return $this->error("\xe5\x88\x9b\xe5\xbb\272\346\x96\207\344\xbb\xb6\xe5\xa4\xb9\xe5\244\xb1\350\264\xa5\357\274\201"); goto o9YTi; FgKOl: $level = array_filter(explode("\54", $level)); goto vhxlx; yPXrT: cv2qI: goto oCwxH; o9YTi: goto kVzIT; goto K7Q7q; f4cYY: $data["\164\171\x70\145"] = "\146\x6f\x6c\144\145\x72"; goto qaN3G; Dv2H3: dQlop: goto OSMpe; KWceL: if (!is_dir($dirname)) { goto dQlop; } goto A0oaZ; Ko_fo: $pid = $request_data["\x70\x69\x64"]; goto yQE_h; ogjr2: return $this->error("\345\210\233\345\273\272\xe6\x96\x87\344\273\266\xe5\244\xb9\345\244\261\xe8\264\xa5\357\xbc\x81"); goto yPXrT; B8SRJ: $folder_path = ''; goto c6gE4; Y2nWu: foreach ($folder as $value) { $folder_path .= $value["\156\141\155\145"] . "\57"; u5cfE: } goto SB0FY; yY1XM: return $this->error("\346\x97\240\346\x95\x88\xe7\232\x84\xe5\x8f\x82\xe6\225\260\357\274\x81"); goto nAsgK; mQPVH: $data["\156\141\155\x65"] = $name; goto t1pif; ZQpGx: tM5Bx: goto sPvrh; oCwxH: $this->db->beginTransaction(); goto h2HFX; DlaDw: $level = $this->_getLevel($id); goto Wrbva; ZZBpw: kVzIT: goto RX5wK; mbm0H: rmdir($dirname); goto pgfq5; OSMpe: if (mkdir($dirname, 493, true)) { goto cv2qI; } goto ogjr2; TyDXM: if ($id = $this->db->insert($this->table, $data)->id()) { goto bBKJU; } goto atNZR; c6gE4: $level = $this->db->select($this->table, "\140\x6c\145\166\145\x6c\x60")->where(array("\151\144", "\x3d", $pid))->get(0); goto tfsCZ; HyA3Q: return $this->error("\xe5\x88\233\xe5\273\272\346\x96\207\xe4\273\xb6\345\xa4\xb9\345\244\261\350\xb4\245\357\xbc\201"); goto sYZfr; SB0FY: ueqCj: goto ZQpGx; A0oaZ: return $this->error($name . "\x20\346\226\207\344\xbb\266\345\xa4\271\345\267\262\345\xad\230\xe5\234\xa8\357\274\x81"); goto Dv2H3; yQE_h: $name = $request_data["\156\x61\x6d\145"]; goto DgXjv; Wrbva: if ($this->db->update($this->table, array("\x6c\x65\x76\145\x6c" => $level), array("\x69\x64", "\x3d", $id))->is()) { goto UEJyh; } goto mbm0H; t1pif: $data["\x70\151\144"] = $pid; goto B8SRJ; nAsgK: Z37eY: goto CPzIL; pgfq5: $this->db->rollBack(); goto z0SSi; h2HFX: $data["\x70\141\x74\x68"] = $this->root . $folder_path; goto kM9zF; sPvrh: $dirname = $this->_UTF82GBK("\x2e\x2e\x2f" . $this->root . $folder_path . $name); goto KWceL; tfsCZ: if (!$level) { goto tM5Bx; } goto FgKOl; DgXjv: if (!($name === null || $name === '')) { goto Z37eY; } goto yY1XM; vhxlx: $folder = $this->db->select($this->table, "\x60\x6e\141\x6d\x65\140")->where(array("\151\x64", "\x49\x4e", $level), "\101\x4e\104", array("\x74\x79\x70\145", "\x3d", "\146\157\154\x64\145\x72"))->all(); goto Y2nWu; EBbXJ: $this->db->commit(); goto ST25i; CPzIL: $data = array(); goto mQPVH; RX5wK: } protected function postRename($request_data) { goto vd2SC; zv1Ki: return $this->error("\346\x97\xa0\xe6\225\210\347\232\x84\345\217\x82\346\225\xb0\357\xbc\x81"); goto KQ1nE; C05RM: foreach ($sublist as $sub) { goto gLWVk; bai52: $newpath = ''; goto xFKlw; lKxFz: goto Ai0bn; goto UpkaZ; GRqAs: Ai0bn: goto evjGP; gLWVk: if (!($sub["\154\x65\166\x65\x6c"] == $finder["\x6c\145\x76\x65\x6c"])) { goto zfbuw; } goto lKxFz; EqV7P: M8uaT: goto mGYAH; TTnEM: IGEk4: goto GRqAs; fMX3a: foreach ($level as $lid) { goto l7Whi; F6Cqr: uoR08: goto uFkJS; HV_LX: goto qP2xw; goto F6Cqr; qN__o: if (!($sub["\164\x79\160\x65"] == "\x66\157\x6c\144\x65\x72" && $sub["\154\145\x76\145\x6c"] == $levelobj["\x6c\x65\x76\x65\x6c"])) { goto uoR08; } goto HV_LX; l7Whi: $levelobj = $this->db->select($this->table, array("\156\141\155\x65", "\x6c\145\x76\x65\154"))->where("\x69\x64\40\75\x20{$lid}\x20\x41\116\104\x20\164\171\160\145\x20\x3d\40\x27\x66\157\x6c\x64\145\x72\47")->get(); goto qN__o; uFkJS: $level_name = $levelobj["\156\x61\155\x65"]; goto iheNY; iheNY: $newpath .= $level_name != '' ? $level_name . "\57" : ''; goto O_Eij; O_Eij: qP2xw: goto sEnXm; sEnXm: } goto EqV7P; mGYAH: $is_path_update = $this->db->update($this->table, array("\x70\x61\x74\150" => $this->root . $newpath), array("\x69\x64", "\x3d", $sub["\x69\144"]))->is(); goto seDJo; seDJo: if (!($is_path_update === false)) { goto IGEk4; } goto SLbQ5; SLbQ5: goto um7H9; goto TTnEM; UpkaZ: zfbuw: goto bai52; xFKlw: $level = array_filter(explode("\x2c", $sub["\x6c\x65\166\x65\154"])); goto fMX3a; evjGP: } goto zhD9J; rmqvN: $this->db->rollBack(); goto hQIAQ; BF7s_: if ($is_path_update !== false) { goto wqM4G; } goto XV_uu; Qk5mQ: ZNc1f: goto F6IOD; TPWdI: pCesd: goto oN20k; O1XK7: mH1l7: goto r9x7z; gYs3j: return $this->error("\xe6\x89\xbe\344\xb8\215\xe5\x88\260\xe9\207\x8d\345\x91\275\xe5\x90\x8d\347\232\204\xe6\226\207\xe4\xbb\266\57\xe6\x96\x87\xe4\xbb\xb6\xe5\xa4\271\357\274\x81"); goto DOURc; VMMMM: pwxzH: goto Rjoxo; d_rXu: $this->db->rollBack(); goto j_1ic; N9A1l: $this->db->rollBack(); goto l9FQd; dRppX: if ($this->db->update($this->table, array("\x6e\x61\x6d\145" => $name), array("\151\144", "\x3d", $id))->is()) { goto pCesd; } goto sMKqO; mCIO5: if (!(!$id || $name === null || $name === '')) { goto m1o2c; } goto zv1Ki; zhD9J: um7H9: goto BF7s_; Dwoqb: goto mH1l7; goto Qk5mQ; nb_tc: XJ1Km: goto Z7V8S; KQ1nE: m1o2c: goto UPq38; gIa2b: wqM4G: goto rCMm9; N73zr: NL_6C: goto O1XK7; gzRMx: goto vjDXV; goto lTYFo; KzSyQ: $this->db->commit(); goto Oia40; PoTgh: Z05f3: goto dRppX; Rjoxo: $oldname = $this->_UTF82GBK("\x2e\56\57" . $path . $finder["\156\x61\155\x65"]); goto jTnfV; DQVz2: if ($this->db->update($this->table, array("\x6e\141\155\145" => $name), array("\151\144", "\75", $id))->is()) { goto ZNc1f; } goto rmqvN; l9FQd: return $this->error("\346\x96\x87\xe4\xbb\xb6\xe9\207\x8d\xe5\221\xbd\xe5\220\215\345\244\xb1\350\264\xa5\xef\274\201"); goto gzRMx; hQIAQ: return $this->error("\346\226\x87\xe4\273\xb6\xe5\244\xb9\351\207\215\xe5\221\275\xe5\x90\215\345\xa4\261\350\264\245\357\274\201"); goto Dwoqb; Oajh8: if (!(!$path || stripos($path, $this->root) === false)) { goto pwxzH; } goto Au0u9; Au0u9: return $this->error("\xe6\227\xa0\xe6\x95\210\347\x9a\x84\xe8\xb7\xaf\xe5\276\x84\357\xbc\x81"); goto VMMMM; r9x7z: EF842: goto JJPbt; ODfFu: goto NL_6C; goto nb_tc; fTnoA: $name = $request_data["\156\141\x6d\145"]; goto mCIO5; F6IOD: if (rename($oldname, $newname)) { goto XJ1Km; } goto d_rXu; udJtH: fIsFm: goto DQVz2; s3N_t: goto DgpVz; goto TPWdI; sMKqO: $this->db->rollBack(); goto OGrY6; jTnfV: $newname = $this->_UTF82GBK("\x2e\56\x2f" . $path . $name); goto FaSy0; H2IRF: goto arzz9; goto gIa2b; UPq38: $finder = $this->db->select($this->table, array("\160\x61\164\150", "\156\141\155\145", "\154\x65\166\x65\x6c"))->where(array("\x69\x64", "\x3d", $id))->get(); goto EsIHt; vd2SC: $id = $request_data["\x69\x64"]; goto fTnoA; OGrY6: return $this->error("\xe6\x96\207\344\xbb\xb6\351\207\x8d\345\x91\275\345\x90\215\345\xa4\261\350\264\xa5\357\274\x81"); goto s3N_t; tNh1s: if (is_dir($oldname)) { goto fIsFm; } goto gYs3j; EsIHt: $path = $finder["\160\x61\x74\150"]; goto Oajh8; jGzXh: goto EF842; goto udJtH; lTYFo: USLgk: goto KzSyQ; rCMm9: $this->db->commit(); goto OIIQl; Oia40: return $this->success(); goto oizsZ; oN20k: if (rename($oldname, $newname)) { goto USLgk; } goto N9A1l; j_1ic: return $this->error($name . "\40\346\x96\x87\xe4\xbb\xb6\xe5\244\xb9\345\267\262\xe5\xad\x98\345\x9c\xa8\xef\274\x81"); goto ODfFu; Z7V8S: $sublist = $this->db->select($this->table, array("\x69\144", "\154\145\166\145\154", "\164\x79\x70\145"))->where(array("\154\145\166\145\154", "\114\x49\x4b\105", "\45\x2c{$id}\x2c\45"))->all(); goto C05RM; r1ErN: arzz9: goto N73zr; XV_uu: rename($newname, $oldname); goto b0293; Zkz7X: return $this->error("\xe6\x96\x87\344\xbb\xb6\345\244\271\351\207\x8d\xe5\221\275\345\x90\215\xe5\xa4\xb1\xe8\xb4\xa5\357\xbc\201"); goto H2IRF; FaSy0: $this->db->beginTransaction(); goto Zwpof; b0293: $this->db->rollBack(); goto Zkz7X; oizsZ: vjDXV: goto dL7PF; Zwpof: if (is_file($oldname)) { goto Z05f3; } goto tNh1s; OIIQl: return $this->success(); goto r1ErN; dL7PF: DgpVz: goto jGzXh; DOURc: goto EF842; goto PoTgh; JJPbt: } protected function postIsFile($request_data) { goto r9gGn; sy0w_: if (file_exists($this->_UTF82GBK("\56\56\x2f" . $path . $name))) { goto jrRT5; } goto eyLDc; IrMUI: $name = $request_data["\x6e\x61\155\x65"]; goto sy0w_; sHLaT: return $this->success($name . "\x20\346\x96\207\344\273\266\xe5\xb7\xb2\xe5\255\230\xe5\x9c\250\xef\xbc\x81"); goto foQpq; eyLDc: return $this->error($name . "\40\346\x96\x87\xe4\273\266\xe4\270\x8d\xe5\xad\x98\xe5\x9c\250\357\xbc\201"); goto TppQQ; r9gGn: $path = $request_data["\160\141\x74\x68"]; goto IrMUI; q1cRD: jrRT5: goto sHLaT; TppQQ: goto t6lZs; goto q1cRD; foQpq: t6lZs: goto Uy6Jk; Uy6Jk: } protected function postDelete($request_data) { goto T8j2f; ufdub: return $this->success(); goto taAAZ; T8j2f: $ids = $request_data["\x69\144"]; goto Itord; Itord: foreach ($ids as $id) { goto Of8DF; viCix: budy4: goto B4RXL; sUWEI: vMlNM: goto lsM2c; M5wYh: $this->db->delete($this->table, array("\151\x64", "\75", $id))->is(); goto pO8of; RZRr5: goto budy4; goto atX5G; By4Ik: $this->_rmdir($filename); goto z4IGh; mIXg4: $filename = $this->_UTF82GBK("\x2e\56\57" . $path . $name); goto cWRDw; Of8DF: $file = $this->db->select($this->table, array("\x70\x61\x74\150", "\156\x61\x6d\145"))->where(array("\151\x64", "\75", $id))->get(); goto cx6VY; jWJdQ: @unlink($filename); goto gIbPn; msmH6: if (!(!$path || stripos($path, "\x64\141\164\x61\x2f\146\x69\x6e\x64\x65\162\x2f") === false || $name == null || $name == '')) { goto XVGeJ; } goto M5wYh; cWRDw: if (is_file($filename)) { goto qpvn7; } goto tgaUr; z4IGh: PN78a: goto viCix; WMmZn: goto BASFq; goto sUWEI; gIbPn: VuHWF: goto RZRr5; atX5G: imEAS: goto ZipA4; NZSPv: qpvn7: goto Xk6vo; y0tRw: $this->db->delete($this->table, array("\x6c\145\x76\145\154", "\x4c\x49\113\105", "\x25\x2c{$id}\x2c\45")); goto xfxTN; tgaUr: if (is_dir($filename)) { goto imEAS; } goto y0tRw; lsM2c: $path = $file["\x70\x61\164\x68"]; goto v2cPM; cx6VY: if ($file) { goto vMlNM; } goto WMmZn; B4RXL: BASFq: goto u90s9; K6_Gq: XVGeJ: goto mIXg4; Xk6vo: if (!$this->db->delete($this->table, array("\x69\x64", "\x3d", $id))->is()) { goto VuHWF; } goto jWJdQ; xfxTN: goto budy4; goto NZSPv; v2cPM: $name = $file["\156\141\155\x65"]; goto msmH6; pO8of: goto BASFq; goto K6_Gq; ZipA4: if (!$this->db->delete($this->table, array("\154\145\x76\x65\154", "\x4c\x49\113\105", "\x25\x2c{$id}\54\x25"))->is()) { goto PN78a; } goto By4Ik; u90s9: } goto tjZMz; tjZMz: XYynB: goto ufdub; taAAZ: } protected function getCurPath($foid) { goto k692D; aT64J: return $this->success('', $data); goto dTYwd; rGj5E: $data = $this->db->select($this->table, array("\151\x64", "\156\x61\155\145"))->where(array(array("\151\144", "\x49\x4e", $level), "\101\116\x44", array("\x74\x79\160\x65", "\x3d", "\x66\x6f\154\144\145\x72")))->all(); goto aT64J; JQUr8: $level = array_filter(explode("\x2c", $level)); goto rGj5E; k692D: $level = $this->db->select($this->table, "\154\x65\166\145\x6c")->where(array("\151\144", "\75", $foid))->get(0); goto JQUr8; dTYwd: } }

<?php
//Copyright (c) 2016 iFeiwu.com
 class Uploader extends Ifeiwu { function __construct() { } protected function postImage($request_data) { goto Qjfss; xMtI1: $handle->file_new_name_body = $file_new_name_body; goto kb8YL; cRX_6: $image_convert = $_POST["\151\155\x61\147\145\x5f\143\x6f\x6e\x76\x65\x72\164"]; goto UJafM; pV0Bk: if (!$file_new_name_body) { goto VeFcl; } goto xMtI1; BafOt: $file_overwrite = $_POST["\x66\151\154\x65\137\x6f\x76\x65\x72\167\162\x69\164\145"]; goto rMlKI; qd1TY: if ($image_resize == 1) { goto mkyP9; } goto AASPi; GYVXx: return $this->success('', array("\x70\141\x74\150" => $file_save_path, "\x69\x6d\x61\147\145" => $handle->file_dst_name, "\163\x69\x7a\x65" => $handle->file_src_size, "\x77\x69\x64\164\150" => $handle->image_src_x, "\150\145\151\147\150\164" => $handle->image_src_y, "\x74\171\x70\145" => $handle->image_dst_type, "\x65\170\164" => $handle->file_dst_name_ext)); goto Twrdt; GXd8B: mRm0w: goto GYVXx; qFqjQ: $file_save_path = $_POST["\146\x69\x6c\145\137\163\x61\x76\x65\x5f\160\x61\164\x68"]; goto cRX_6; D8K3s: if (!$image_convert) { goto IvrRg; } goto dYBqV; V1KNk: goto UDCJh; goto Q4DVN; lE9WV: $image_y = explode("\54", $_POST["\151\155\x61\147\145\137\171"]); goto UcHR0; dYBqV: $handle->image_convert = $image_convert; goto vBuPA; YC1GP: $file_new_name_body = $_POST["\x66\x69\x6c\x65\x5f\x6e\145\167\x5f\x6e\141\x6d\x65\137\142\157\144\x79"]; goto BafOt; TFnuY: $handle->file_overwrite = $file_overwrite ? true : false; goto wtBY6; D2IXc: $_FILES["\x66\151\154\x65"]["\145\162\x72\x6f\x72"] = $_POST["\x66\x69\x6c\x65\137\145\x72\x72\x6f\162"]; goto t2QGD; gA_em: yRU2q: goto Jx3tj; hNSiF: return $this->error("\xe6\x97\240\346\x95\210\xe7\x9a\204\346\x96\207\344\273\xb6\xe4\277\241\346\x81\xaf\xef\xbc\201"); goto uTXQH; OFvnf: $handle = new Upload($_FILES["\146\x69\154\145"]); goto RmDDf; t2QGD: if (!empty($_FILES["\x66\x69\x6c\x65"])) { goto E90LW; } goto hNSiF; Iz5je: EcLQP: goto II95d; WK5vZ: return $this->error($handle->log); goto gV204; cWlnr: E90LW: goto BeLhx; uzbje: $file_name_body_pre = explode("\54", $_POST["\x66\151\x6c\x65\137\x6e\141\x6d\x65\x5f\142\157\144\x79\137\x70\x72\145"]); goto xkoY6; UcHR0: foreach ($file_name_body_pre as $key => $prefix) { goto Z1o1Z; eMi6Y: thMSU: goto KXvvd; vpllf: Vs235: goto f8wnh; gL3GU: if (!$image_convert) { goto xeRo9; } goto fT8Mk; mnvKL: $handle->image_resize = $image_resize ? true : false; goto YLWHv; c2TBJ: cz1BP: goto xgFg5; QupO0: goto AuFLk; goto TH71J; Skj9R: if (!$file_new_name_body) { goto cz1BP; } goto ka5_c; SPOMP: if (!$prefix) { goto thMSU; } goto mnvKL; jpayG: goto VLXqr; goto vpllf; Mpw7r: if ($width && $handle->image_src_x > $width) { goto NJ8R0; } goto TKiFR; mDgrd: WyteV: goto rpZ1q; brFte: $quality = $jpeg_quality[$key]; goto SPOMP; nCiyF: $handle->image_ratio_y = true; goto jpayG; KXvvd: if (!$quality) { goto Wbiz3; } goto gYn92; xgFg5: $handle->file_overwrite = $file_overwrite ? true : false; goto CgaNc; YLWHv: $handle->file_name_body_pre = $prefix; goto eMi6Y; Z1o1Z: $width = $image_x[$key]; goto NFmTA; NFmTA: $height = $image_y[$key]; goto brFte; U2HWE: xeRo9: goto Mpw7r; cCjki: Wbiz3: goto gL3GU; fT8Mk: $handle->image_convert = $image_convert; goto U2HWE; LBEiM: AuFLk: goto bz1Bz; ztgG9: VLXqr: goto Skj9R; f8wnh: $handle->image_y = $height; goto ztgG9; TH71J: NJ8R0: goto RL7NV; ka5_c: $handle->file_new_name_body = $file_new_name_body; goto c2TBJ; bz1Bz: if ($height && $handle->image_src_y > $height) { goto Vs235; } goto nCiyF; gYn92: $handle->jpeg_quality = $quality; goto cCjki; TKiFR: $handle->image_x = $handle->image_src_x; goto QupO0; CgaNc: $handle->Process($upload_root . "\57" . $file_save_path); goto mDgrd; RL7NV: $handle->image_x = $width; goto LBEiM; rpZ1q: } goto plM17; SV2eN: $_FILES["\146\x69\x6c\145"]["\x73\x69\172\x65"] = $_POST["\146\x69\x6c\145\x5f\x73\151\x7a\145"]; goto D2IXc; II95d: if ($handle->processed) { goto yRU2q; } goto WK5vZ; vBuPA: IvrRg: goto pV0Bk; rMlKI: $image_resize = $_POST["\x69\x6d\x61\147\x65\x5f\162\145\x73\x69\172\145"]; goto qFqjQ; xkoY6: $image_x = explode("\54", $_POST["\x69\155\x61\x67\145\137\170"]); goto lE9WV; pBNzm: $file_save_path = ''; goto GXd8B; UJafM: $jpeg_quality = explode("\54", $_POST["\x6a\x70\x65\147\x5f\161\x75\x61\x6c\151\164\171"]); goto qd1TY; XTrKq: $_FILES["\146\x69\x6c\x65"]["\x74\x79\x70\x65"] = $_POST["\146\151\x6c\145\x5f\164\x79\160\x65"]; goto SV2eN; rMnLb: D5e04: goto D8K3s; nNTur: if (!$quality) { goto D5e04; } goto mpnmc; wtBY6: $handle->Process($upload_root . "\x2f" . $file_save_path); goto V1KNk; gV204: goto kz1kA; goto gA_em; CE4Nf: UDCJh: goto Iz5je; BeLhx: ifeiwu\Loader::import("\x65\170\x74\x65\x6e\144\57\x55\160\x6c\157\x61\144"); goto OFvnf; plM17: HfpTV: goto CE4Nf; kb8YL: VeFcl: goto TFnuY; uTXQH: goto u6ssm; goto cWlnr; RmDDf: if (!$handle->uploaded) { goto EcLQP; } goto dht8A; Twrdt: kz1kA: goto sezxt; sezxt: u6ssm: goto BZZwp; mpnmc: $handle->jpeg_quality = $quality; goto rMnLb; Q4DVN: mkyP9: goto uzbje; dht8A: $upload_root = "\x2e\56\x2f"; goto YC1GP; AASPi: $quality = end($jpeg_quality); goto nNTur; Qjfss: $_FILES["\x66\x69\154\145"]["\156\141\155\145"] = $_POST["\x66\x69\154\145\x5f\x6e\x61\x6d\x65"]; goto XTrKq; Jx3tj: if (!($file_save_path == "\57")) { goto mRm0w; } goto pBNzm; BZZwp: } protected function postFile($request_data) { goto nnHzB; v3hTU: $_FILES["\x66\x69\x6c\145"]["\145\162\x72\157\x72"] = $_POST["\146\x69\x6c\x65\x5f\145\162\162\x6f\x72"]; goto aDHqf; XbrtR: $_FILES["\x66\151\154\145"]["\x6e\x61\155\x65"] = $_POST["\146\x69\x6c\x65\x5f\x6e\x61\x6d\145"]; goto Khd5O; Khd5O: $_FILES["\x66\151\154\145"]["\164\171\160\145"] = $_POST["\x66\151\154\x65\x5f\x74\x79\160\145"]; goto GcVlL; HjNXz: ZwyS3: goto EA0O4; zIUU4: $this->_debug("\x65\x72\162\157\162\40" . $file["\145\162\162\157\162"] . "\x20\151\156\x20\x66\151\x6c\145\x20" . $resumableFilename); goto uIT8l; WSd7Y: goto ZwyS3; goto XWNfS; pBsWq: $this->_createFileFromChunks($save_path, $temp_dir, $resumableFilename, $_POST["\x72\145\163\165\155\141\142\x6c\145\x43\150\165\x6e\x6b\x53\151\172\145"], $_POST["\162\145\163\165\x6d\141\142\154\x65\x54\x6f\164\x61\154\x53\x69\x7a\x65"]); goto WSd7Y; cIG5q: if (!move_uploaded_file($file["\x74\x6d\x70\137\156\x61\155\145"], $dest_file)) { goto QP00A; } goto pBsWq; FCDwG: if (!($file["\145\x72\162\157\162"] != 0)) { goto gfrhn; } goto zIUU4; TdkXc: if (is_dir($temp_dir)) { goto yKamu; } goto O_8CY; aDHqf: $file = $_FILES["\146\151\154\145"]; goto FCDwG; GPTv6: $resumableFilename = $this->_UTF82GBK($_POST["\x72\145\163\x75\155\x61\x62\154\145\106\151\154\145\x6e\141\x6d\145"]); goto agRVg; zAJZD: $dest_file = $temp_dir . "\57" . $resumableFilename . "\x2e\160\x61\162\164" . $resumableChunkNumber; goto TdkXc; agRVg: $resumableChunkNumber = $_POST["\x72\x65\x73\x75\155\141\142\154\x65\x43\150\165\x6e\153\116\165\155\x62\x65\162"]; goto yF094; Wes1b: yKamu: goto cIG5q; nnHzB: $save_path = "\56\x2e\x2f" . $this->_UTF82GBK($_POST["\163\141\x76\145\137\160\141\164\x68"]); goto GPTv6; GcVlL: $_FILES["\x66\x69\x6c\x65"]["\163\x69\172\145"] = $_POST["\x66\x69\x6c\x65\137\x73\x69\x7a\x65"]; goto v3hTU; yF094: $resumableIdentifier = $_POST["\162\x65\163\165\155\x61\x62\154\145\x49\144\145\156\x74\x69\x66\151\145\162"]; goto XbrtR; uIT8l: gfrhn: goto rs8eJ; XWNfS: QP00A: goto WbxCy; WbxCy: $this->_debug("\x45\162\x72\157\162\x20\x73\141\x76\151\x6e\147\x20\50\155\157\166\x65\137\165\x70\x6c\x6f\x61\x64\145\x64\x5f\146\151\154\x65\x29\40\143\x68\x75\156\153\x20" . $resumableChunkNumber . "\40\146\x6f\162\x20\x66\x69\154\x65\40" . $resumableFilename); goto HjNXz; rs8eJ: $temp_dir = $save_path . "\57" . $resumableIdentifier; goto zAJZD; O_8CY: mkdir($temp_dir, 511, true); goto Wes1b; EA0O4: } protected function getFile() { goto p3X3L; iy9I5: $resumableChunkNumber = $_GET["\162\x65\x73\165\x6d\x61\142\154\x65\x43\150\x75\156\x6b\116\x75\155\x62\x65\x72"]; goto G07hT; K7YLg: $chunk_file = $temp_dir . "\x2f" . $resumableFilename . "\x2e\160\141\162\x74" . $resumableChunkNumber; goto S2AFD; OOsYt: return 404; goto DSMch; CkDS9: return 202; goto c1iHN; p3X3L: $save_path = "\x2e\56\x2f" . $this->_UTF82GBK($_GET["\163\141\x76\x65\137\x70\x61\x74\150"]); goto h2sux; kdZ6I: $temp_dir = $save_path . "\57" . $resumableIdentifier; goto K7YLg; c1iHN: mabdC: goto S0OBB; DSMch: goto mabdC; goto adMBS; S2AFD: if (file_exists($chunk_file)) { goto CgGyu; } goto OOsYt; h2sux: $resumableFilename = $this->_UTF82GBK($_GET["\162\145\163\x75\155\141\142\x6c\145\106\x69\154\145\156\x61\x6d\145"]); goto iy9I5; adMBS: CgGyu: goto CkDS9; G07hT: $resumableIdentifier = $_GET["\162\x65\163\165\155\x61\142\x6c\145\x49\144\145\156\164\x69\146\151\x65\x72"]; goto kdZ6I; S0OBB: } private function _createFileFromChunks($save_path, $temp_dir, $fileName, $chunkSize, $totalSize) { goto c5Mt9; lA2hU: TWZng: goto gxZJV; H1jSK: $this->_debug("\x63\x61\x6e\x6e\157\x74\x20\x63\x72\x65\x61\x74\x65\x20\x74\150\x65\x20\144\x65\163\164\x69\156\141\x74\x69\x6f\156\x20\x66\151\154\145"); goto IwxoG; HBOBh: s8I1b: goto pkbPq; Py61c: goto TWZng; goto HdEgP; CgDiG: $this->_rrmdir($temp_dir); goto mJ03N; gEcog: MO4xg: goto JPz_4; RudNE: goto KwHcN; goto Y_T7y; JzOz0: fwrite($fp, file_get_contents($temp_dir . "\x2f" . $fileName . "\56\160\141\x72\x74" . $i)); goto UKfYt; HdEgP: r70XD: goto NZFGN; mJ03N: goto GUPyE; goto gEcog; JPz_4: $this->_rrmdir($temp_dir . "\137\125\116\125\x53\x45\x44"); goto ApOid; UKfYt: QEXvz: goto yFJJ4; Y_T7y: ezeRh: goto t_ApB; IwxoG: return false; goto Py61c; t_ApB: fclose($fp); goto lA2hU; jKFBL: n8Qxv: goto MIPpM; c5Mt9: $total_files = 0; goto KM6H2; ApOid: GUPyE: goto jKFBL; gxZJV: if (rename($temp_dir, $temp_dir . "\x5f\x55\116\125\123\x45\x44")) { goto MO4xg; } goto CgDiG; KM6H2: foreach (scandir($temp_dir) as $file) { goto efNiK; og6QU: cvjEw: goto vvg4a; s5RLo: $total_files++; goto yThuO; yThuO: jSdnD: goto og6QU; efNiK: if (!(stripos($file, $fileName) !== false)) { goto jSdnD; } goto s5RLo; vvg4a: } goto HBOBh; aX48W: KwHcN: goto mfvS3; mfvS3: if (!($i <= $total_files)) { goto ezeRh; } goto JzOz0; NZFGN: $i = 1; goto aX48W; pkbPq: if (!($total_files * $chunkSize >= $totalSize - $chunkSize + 1)) { goto n8Qxv; } goto X1Yd6; yFJJ4: $i++; goto RudNE; X1Yd6: if (($fp = fopen($save_path . "\x2f" . $fileName, "\x77")) !== false) { goto r70XD; } goto H1jSK; MIPpM: } private function _rrmdir($dir) { goto KhQeP; jfXmX: reset($objects); goto tWPZe; iz3Wv: m0ITQ: goto fP9vb; tWPZe: rmdir($dir); goto iz3Wv; ji5Ay: foreach ($objects as $object) { goto sfrWk; noqhb: jomlu: goto kvJ3r; x4rnu: $this->_rrmdir($dir . "\57" . $object); goto noqhb; kvJ3r: bXN6D: goto vQvgb; e_Pd1: if (filetype($dir . "\x2f" . $object) == "\144\x69\x72") { goto XxXK3; } goto MgzZ7; GXQVO: XxXK3: goto x4rnu; nJ4xk: goto jomlu; goto GXQVO; MgzZ7: unlink($dir . "\57" . $object); goto nJ4xk; vQvgb: NY6_A: goto i1uFL; sfrWk: if (!($object != "\x2e" && $object != "\56\56")) { goto bXN6D; } goto e_Pd1; i1uFL: } goto CFNw5; KhQeP: if (!is_dir($dir)) { goto m0ITQ; } goto F2n7D; F2n7D: $objects = scandir($dir); goto ji5Ay; CFNw5: xK8zw: goto jfXmX; fP9vb: } }
